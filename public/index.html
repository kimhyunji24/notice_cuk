<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ì•Œë¦¬ì•Œë¦¬</title>
    <link rel="stylesheet" href="style.css">
    <link rel="manifest" href="manifest.json">
    <link rel="icon" href="favicon.ico">
    <meta name="theme-color" content="#2563eb">
    <meta name="description" content="ê°€í†¨ë¦­ëŒ€í•™êµ í•™ê³¼ ê³µì§€ì‚¬í•­ì„ ì‹¤ì‹œê°„ìœ¼ë¡œ ë°›ì•„ë³´ì„¸ìš”">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
</head>
<body>
    <div class="container">
        <header class="header">
            <div class="header-content">
                <h1 class="title">
                    <span class="title-icon">ğŸ””</span>
                    ì•Œë¦¬ì•Œë¦¬
                </h1>
                <p class="subtitle">ê°€í†¨ë¦­ëŒ€í•™êµ í•™ê³¼ ê³µì§€ì‚¬í•­ì„ ì‹¤ì‹œê°„ìœ¼ë¡œ ë°›ì•„ë³´ì„¸ìš”</p>
            </div>
        </header>

        <main class="main">
            <!-- ì•Œë¦¼ ê¶Œí•œ ìƒíƒœ -->
            <div id="permission-card" class="card hidden">
                <div class="card-header">
                    <h2>ğŸ” ì•Œë¦¼ ê¶Œí•œ í•„ìš”</h2>
                </div>
                <div class="card-content">
                    <p>ê³µì§€ì‚¬í•­ ì•Œë¦¼ì„ ë°›ìœ¼ë ¤ë©´ ë¸Œë¼ìš°ì € ì•Œë¦¼ ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤.</p>
                    <button id="enable-notifications" class="btn btn-primary">
                        ì•Œë¦¼ ê¶Œí•œ í—ˆìš©í•˜ê¸°
                    </button>
                </div>
            </div>

            <!-- êµ¬ë… ì„¤ì • -->
            <div id="subscription-card" class="card">
                <div class="card-header">
                    <h2>ğŸ“š êµ¬ë…í•  í•™ê³¼ ì„ íƒ</h2>
                    <button id="manage-subscriptions" class="btn-secondary" style="margin-top: 10px;">
                        ğŸ“‹ ë‚´ êµ¬ë… ê´€ë¦¬
                    </button>
                </div>
                <div class="card-content">
                    <div id="loading-state" class="loading">
                        <div class="spinner"></div>
                        <p>í•™ê³¼ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
                    </div>

                    <div id="subscription-form" class="hidden">
                        <div class="search-container">
                            <input type="text" id="search-input" class="search-input" 
                                   placeholder="í•™ê³¼ëª…ì„ ê²€ìƒ‰í•˜ì„¸ìš” (ì˜ˆ: ì»´í“¨í„°, ì˜ì–´, ê²½ì˜)">
                        </div>

                        <div class="filter-tabs">
                            <button class="filter-tab active" data-category="all">ì „ì²´</button>
                            <button class="filter-tab" data-category="ê³µí•™ê³„ì—´">ê³µí•™</button>
                            <button class="filter-tab" data-category="ì¸ë¬¸ê³„ì—´">ì¸ë¬¸</button>
                            <button class="filter-tab" data-category="ê²½ì˜ê³„ì—´">ê²½ì˜</button>
                            <button class="filter-tab" data-category="ìì—°ê³„ì—´">ìì—°</button>
                        </div>

                        <div class="select-actions">
                            <button id="select-all" class="btn btn-secondary">ì „ì²´ ì„ íƒ</button>
                            <button id="clear-all" class="btn btn-secondary">ì „ì²´ í•´ì œ</button>
                            <span id="selected-count" class="selected-count">ì„ íƒë¨: 0ê°œ</span>
                        </div>

                        <div id="sites-container" class="sites-grid">
                            <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
                        </div>

                        <div class="form-actions">
                            <button id="save-subscription" class="btn btn-primary" disabled>
                                <span class="btn-text">êµ¬ë… ì„¤ì • ì €ì¥</span>
                                <div class="btn-loading hidden">
                                    <div class="spinner-small"></div>
                                </div>
                            </button>
                            <button id="test-notification" class="btn btn-secondary">
                                í…ŒìŠ¤íŠ¸ ì•Œë¦¼
                            </button>
                        </div>
                    </div>

                    <!-- êµ¬ë… ê´€ë¦¬ ì˜ì—­ -->
                    <div id="subscription-list" class="hidden">
                        <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
                    </div>

                    <!-- êµ¬ë… ìˆ˜ì • ë²„íŠ¼ë“¤ -->
                    <div class="subscription-edit-actions hidden">
                        <button id="save-subscriptions" class="btn btn-primary" style="display: none;">
                            êµ¬ë… ì €ì¥
                        </button>
                        <button id="cancel-edit" class="btn btn-secondary" style="display: none;">
                            ì·¨ì†Œ
                        </button>
                    </div>
                </div>
            </div>

            <!-- ìƒíƒœ ë©”ì‹œì§€ -->
            <div id="message-area" class="message-area hidden">
                <!-- ë™ì ìœ¼ë¡œ ë©”ì‹œì§€ê°€ í‘œì‹œë¨ -->
            </div>
        </main>

        <footer class="footer">
            <div class="footer-content">
                <div class="footer-links">
                    <a href="status-enhanced.html" class="footer-link">í¬ë¡¤ë§ ìƒíƒœ í™•ì¸</a>
                    <a href="#" id="test-notification-footer" class="footer-link">ì•Œë¦¼ í…ŒìŠ¤íŠ¸</a>
                </div>
                <p class="footer-text">
                    Â© 2025 ì•Œë¦¬ì•Œë¦¬ | 
                    <a href="https://www.catholic.ac.kr" target="_blank" rel="noopener">ê°€í†¨ë¦­ëŒ€í•™êµ</a>
                </p>
            </div>
        </footer>
        
        <!-- ëª¨ë°”ì¼ í•˜ë‹¨ ë„¤ë¹„ê²Œì´ì…˜ -->
        <nav class="bottom-nav">
            <a href="#" class="nav-item active" id="nav-home">
                <span class="nav-icon">ğŸ </span>
                <span>í™ˆ</span>
            </a>
            <a href="#" class="nav-item" id="nav-subscribe">
                <span class="nav-icon">ğŸ””</span>
                <span>êµ¬ë…</span>
            </a>
            <a href="#" class="nav-item" id="nav-manage">
                <span class="nav-icon">ğŸ“‹</span>
                <span>ê´€ë¦¬</span>
            </a>
            <a href="#" class="nav-item" id="nav-token">
                <span class="nav-icon">ğŸ”‘</span>
                <span>í† í°</span>
            </a>
            <a href="#" class="nav-item" id="nav-debug">
                <span class="nav-icon">ğŸ”§</span>
                <span>ë””ë²„ê·¸</span>
            </a>
            <a href="status-enhanced.html" class="nav-item">
                <span class="nav-icon">ğŸ“Š</span>
                <span>ìƒíƒœ</span>
            </a>
        </nav>
    </div>

    <!-- í™˜ê²½ ì„¤ì • (ê°€ì¥ ë¨¼ì € ë¡œë“œ) -->
    <script src="config.js"></script>
    
    <!-- Firebase v9+ ëª¨ë“ˆëŸ¬ SDK (ê³µì‹ ë¬¸ì„œ ê¶Œì¥ ë°©ì‹) -->
    <script type="module">
        try {
            const { initializeApp } = await import('https://www.gstatic.com/firebasejs/10.13.2/firebase-app.js');
            const { getMessaging, getToken, onMessage, isSupported } = await import('https://www.gstatic.com/firebasejs/10.13.2/firebase-messaging.js');
            
            // ì „ì—­ìœ¼ë¡œ ë…¸ì¶œ
            window.firebaseV9 = {
                initializeApp,
                getMessaging,
                getToken,
                onMessage,
                isSupported
            };
            
            console.log('ğŸ”¥ Firebase v9+ ëª¨ë“ˆëŸ¬ SDK ë¡œë“œ ì™„ë£Œ');
            
            // Firebaseê°€ ë¡œë“œëœ í›„ ë©”ì¸ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰
            if (typeof window.initializeMainApp === 'function') {
                window.initializeMainApp();
            }
        } catch (error) {
            console.error('âŒ Firebase SDK ë¡œë“œ ì‹¤íŒ¨:', error);
            // ê¸°ë³¸ ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ
            document.body.innerHTML += `
                <div style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); 
                           background: #fee; padding: 20px; border-radius: 8px; border: 1px solid #fcc; 
                           font-family: Arial, sans-serif; text-align: center; z-index: 9999;">
                    <h3 style="color: #c33; margin: 0 0 10px 0;">Firebase ë¡œë“œ ì‹¤íŒ¨</h3>
                    <p style="margin: 0 0 10px 0;">${error.message}</p>
                    <button onclick="location.reload()" style="padding: 8px 16px; background: #c33; color: white; border: none; border-radius: 4px; cursor: pointer;">ìƒˆë¡œê³ ì¹¨</button>
                </div>
            `;
        }
    </script>
    
    <!-- ë©”ì¸ ìŠ¤í¬ë¦½íŠ¸ -->
    <script src="script.js"></script>
</body>
</html>