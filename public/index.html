<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>알리알리</title>
    <link rel="stylesheet" href="style.css">
    <link rel="manifest" href="manifest.json">
    <link rel="icon" href="favicon.ico">
    <meta name="theme-color" content="#2563eb">
    <meta name="description" content="가톨릭대학교 학과 공지사항을 실시간으로 받아보세요">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
</head>
<body>
    <div class="container">
        <header class="header">
            <div class="header-content">
                <h1 class="title">
                    <span class="title-icon">🔔</span>
                    알리알리
                </h1>
                <p class="subtitle">가톨릭대학교 학과 공지사항을 실시간으로 받아보세요</p>
            </div>
        </header>

        <main class="main">
            <!-- 알림 권한 상태 -->
            <div id="permission-card" class="card hidden">
                <div class="card-header">
                    <h2>🔐 알림 권한 필요</h2>
                </div>
                <div class="card-content">
                    <p>공지사항 알림을 받으려면 브라우저 알림 권한이 필요합니다.</p>
                    <button id="enable-notifications" class="btn btn-primary">
                        알림 권한 허용하기
                    </button>
                </div>
            </div>

            <!-- 구독 설정 -->
            <div id="subscription-card" class="card">
                <div class="card-header">
                    <h2>📚 구독할 학과 선택</h2>
                    <button id="manage-subscriptions" class="btn-secondary" style="margin-top: 10px;">
                        📋 내 구독 관리
                    </button>
                </div>
                <div class="card-content">
                    <div id="loading-state" class="loading">
                        <div class="spinner"></div>
                        <p>학과 목록을 불러오는 중...</p>
                    </div>

                    <div id="subscription-form" class="hidden">
                        <div class="search-container">
                            <input type="text" id="search-input" class="search-input" 
                                   placeholder="학과명을 검색하세요 (예: 컴퓨터, 영어, 경영)">
                        </div>

                        <div class="filter-tabs">
                            <button class="filter-tab active" data-category="all">전체</button>
                            <button class="filter-tab" data-category="공학계열">공학</button>
                            <button class="filter-tab" data-category="인문계열">인문</button>
                            <button class="filter-tab" data-category="경영계열">경영</button>
                            <button class="filter-tab" data-category="자연계열">자연</button>
                        </div>

                        <div class="select-actions">
                            <button id="select-all" class="btn btn-secondary">전체 선택</button>
                            <button id="clear-all" class="btn btn-secondary">전체 해제</button>
                            <span id="selected-count" class="selected-count">선택됨: 0개</span>
                        </div>

                        <div id="sites-container" class="sites-grid">
                            <!-- 동적으로 생성됨 -->
                        </div>

                        <div class="form-actions">
                            <button id="save-subscription" class="btn btn-primary" disabled>
                                <span class="btn-text">구독 설정 저장</span>
                                <div class="btn-loading hidden">
                                    <div class="spinner-small"></div>
                                </div>
                            </button>
                            <button id="test-notification" class="btn btn-secondary">
                                테스트 알림
                            </button>
                        </div>
                    </div>

                    <!-- 구독 관리 영역 -->
                    <div id="subscription-list" class="hidden">
                        <!-- 동적으로 생성됨 -->
                    </div>

                    <!-- 구독 수정 버튼들 -->
                    <div class="subscription-edit-actions hidden">
                        <button id="save-subscriptions" class="btn btn-primary" style="display: none;">
                            구독 저장
                        </button>
                        <button id="cancel-edit" class="btn btn-secondary" style="display: none;">
                            취소
                        </button>
                    </div>
                </div>
            </div>

            <!-- 상태 메시지 -->
            <div id="message-area" class="message-area hidden">
                <!-- 동적으로 메시지가 표시됨 -->
            </div>
        </main>

        <footer class="footer">
            <div class="footer-content">
                <div class="footer-links">
                    <a href="status-enhanced.html" class="footer-link">크롤링 상태 확인</a>
                    <a href="#" id="test-notification-footer" class="footer-link">알림 테스트</a>
                </div>
                <p class="footer-text">
                    © 2025 알리알리 | 
                    <a href="https://www.catholic.ac.kr" target="_blank" rel="noopener">가톨릭대학교</a>
                </p>
            </div>
        </footer>
        
        <!-- 모바일 하단 네비게이션 -->
        <nav class="bottom-nav">
            <a href="#" class="nav-item active" id="nav-home">
                <span class="nav-icon">🏠</span>
                <span>홈</span>
            </a>
            <a href="#" class="nav-item" id="nav-subscribe">
                <span class="nav-icon">🔔</span>
                <span>구독</span>
            </a>
            <a href="#" class="nav-item" id="nav-manage">
                <span class="nav-icon">📋</span>
                <span>관리</span>
            </a>
            <a href="#" class="nav-item" id="nav-token">
                <span class="nav-icon">🔑</span>
                <span>토큰</span>
            </a>
            <a href="#" class="nav-item" id="nav-debug">
                <span class="nav-icon">🔧</span>
                <span>디버그</span>
            </a>
            <a href="status-enhanced.html" class="nav-item">
                <span class="nav-icon">📊</span>
                <span>상태</span>
            </a>
        </nav>
    </div>

    <!-- 환경 설정 (가장 먼저 로드) -->
    <script src="config.js"></script>
    
    <!-- Firebase v9+ 모듈러 SDK (공식 문서 권장 방식) -->
    <script type="module">
        try {
            const { initializeApp } = await import('https://www.gstatic.com/firebasejs/10.13.2/firebase-app.js');
            const { getMessaging, getToken, onMessage, isSupported } = await import('https://www.gstatic.com/firebasejs/10.13.2/firebase-messaging.js');
            
            // 전역으로 노출
            window.firebaseV9 = {
                initializeApp,
                getMessaging,
                getToken,
                onMessage,
                isSupported
            };
            
            console.log('🔥 Firebase v9+ 모듈러 SDK 로드 완료');
            
            // Firebase가 로드된 후 메인 스크립트 실행
            if (typeof window.initializeMainApp === 'function') {
                window.initializeMainApp();
            }
        } catch (error) {
            console.error('❌ Firebase SDK 로드 실패:', error);
            // 기본 에러 메시지 표시
            document.body.innerHTML += `
                <div style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); 
                           background: #fee; padding: 20px; border-radius: 8px; border: 1px solid #fcc; 
                           font-family: Arial, sans-serif; text-align: center; z-index: 9999;">
                    <h3 style="color: #c33; margin: 0 0 10px 0;">Firebase 로드 실패</h3>
                    <p style="margin: 0 0 10px 0;">${error.message}</p>
                    <button onclick="location.reload()" style="padding: 8px 16px; background: #c33; color: white; border: none; border-radius: 4px; cursor: pointer;">새로고침</button>
                </div>
            `;
        }
    </script>
    
    <!-- 메인 스크립트 -->
    <script src="script.js"></script>
</body>
</html>